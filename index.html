<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实验室试剂库</title>
    <style>
        :root { --main-blue: #2c3e50; --accent-orange: #f39c12; --bg: #f4f7f6; }
        body { font-family: "Microsoft YaHei", sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 750px; margin: 0 auto; }
        
        /* 顶部标题和搜索栏 */
        .top-bar { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; position: sticky; top: 0; background: var(--bg); padding: 10px 0; z-index: 100; }
        .search-wrapper { flex: 1; position: relative; }
        input#uiSearch { width: 100%; padding: 12px 20px; border: 2px solid #ced4da; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        input#uiSearch:focus { border-color: var(--main-blue); outline: none; }
        
        /* 添加按钮 */
        .btn-add { background: var(--main-blue); color: white; border: none; border-radius: 8px; width: 48px; height: 48px; cursor: pointer; font-size: 24px; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
        .btn-add:hover { background: #1a252f; }

        /* 试剂卡片样式 */
        .reagent-card { background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: flex-start; }
        .content-left { flex: 1; }
        .name-row { font-weight: bold; font-size: 1.25em; color: #333; margin-bottom: 8px; }
        .cas-row { color: #7f8c8d; font-size: 0.9em; }
        
        /* 显眼的位置标签 */
        .location-badge { background: #34495e; color: #fff; padding: 6px 15px; border-radius: 6px; font-family: "Consolas", monospace; font-weight: bold; font-size: 1.1em; box-shadow: 0 2px 4px rgba(0,0,0,0.2); margin-left: 15px; white-space: nowrap; }

        /* 删除按钮 */
        .btn-del { color: #e74c3c; background: none; border: 1px solid #e74c3c; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8em; margin-top: 12px; transition: all 0.2s; }
        .btn-del:hover { background: #e74c3c; color: white; }

        .stats { font-size: 0.9em; color: #95a5a6; margin-bottom: 10px; }

        /* 弹窗样式 */
        #addModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 12px; box-shadow: 0 15px 50px rgba(0,0,0,0.3); z-index: 1001; width: 320px; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; }
        .modal-input { width: 100%; margin-bottom: 15px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        .modal-btns { display: flex; gap: 10px; }
        .btn-confirm { flex: 1; background: var(--main-blue); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="top-bar">
        <div class="search-wrapper">
            <input type="text" id="uiSearch" oninput="doSearch()" placeholder="搜索试剂名称、位置或CAS号...">
        </div>
        <button class="btn-add" onclick="toggleModal(true)" title="添加新试剂">+</button>
    </div>

    <div id="statsInfo" class="stats">正在从仓库加载数据...</div>
    <div id="results"></div>
</div>

<div id="overlay" onclick="toggleModal(false)"></div>
<div id="addModal">
    <h3 style="margin-top:0">添加新试剂</h3>
    <input type="text" id="newName" class="modal-input" placeholder="试剂名称 (必填)">
    <input type="text" id="newLoc" class="modal-input" placeholder="储存位置 (必填, 如 3-02)">
    <input type="text" id="newCas" class="modal-input" placeholder="cas号 (选填)">
    <div class="modal-btns">
        <button class="btn-confirm" onclick="addNew()">确定添加</button>
    </div>
</div>

<script>
    let allData = [];

    // 初始化加载
    fetch('data.json')
        .then(res => res.json())
        .then(data => {
            allData = data;
            render(allData);
        })
        .catch(err => {
            document.getElementById('statsInfo').innerText = "加载失败，请检查 data.json 文件";
        });

    function render(list) {
        const container = document.getElementById('results');
        const stats = document.getElementById('statsInfo');
        container.innerHTML = '';
        stats.innerText = `当前显示: ${list.length} 条记录`;
        
        list.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'reagent-card';
            card.innerHTML = `
                <div class="content-left">
                    <div class="name-row">${item['试剂名称']}</div>
                    <div class="cas-row">CAS号: ${item['cas号'] || '--'}</div>
                    <button class="btn-del" onclick="deleteItem(${index})">删除试剂</button>
                </div>
                <div class="location-badge">${item['储存位置']}</div>
            `;
            container.appendChild(card);
        });
    }

    function doSearch() {
        const key = document.getElementById('uiSearch').value.toLowerCase();
        const filtered = allData.filter(item => 
            (item['试剂名称'] || '').toLowerCase().includes(key) || 
            (item['储存位置'] || '').toLowerCase().includes(key) ||
            (item['cas号'] || '').includes(key)
        );
        render(filtered);
    }

    function toggleModal(show) {
        document.getElementById('addModal').style.display = show ? 'block' : 'none';
        document.getElementById('overlay').style.display = show ? 'block' : 'none';
    }

    function addNew() {
        const name = document.getElementById('newName').value.trim();
        const loc = document.getElementById('newLoc').value.trim();
        const cas = document.getElementById('newCas').value.trim();
        
        if(!name || !loc) {
            alert("名称和位置不能为空！");
            return;
        }

        // 重复性检查：检查名称是否已存在
        const exists = allData.some(item => item['试剂名称'] === name);
        if (exists) {
            alert(`该试剂 [${name}] 已存在试剂库中！`);
            return;
        }
        
        allData.unshift({ "试剂名称": name, "储存位置": loc, "cas号": cas });
        render(allData);
        toggleModal(false);
        
        // 清空输入
        document.getElementById('newName').value = '';
        document.getElementById('newLoc').value = '';
        document.getElementById('newCas').value = '';
    }

    function deleteItem(index) {
        if(confirm("确定要删除此试剂吗？(注意：刷新页面后将恢复，除非修改 data.json)")) {
            allData.splice(index, 1);
            render(allData);
        }
    }
</script>
</body>
</html>
